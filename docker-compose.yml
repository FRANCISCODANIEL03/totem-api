services:
  # ---------------------------------
  # SERVICIO 1: TU API
  # ---------------------------------
  mi-api:
    build: .
    restart: always
    ports:
      - "5005:5005"
    environment:
      DATABASE_URL: "postgresql://${DB_USER}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_NAME}"
      S3_ENDPOINT: "minio:9000"
      
      S3_ACCESS_KEY: "${MINIO_ROOT_USER}"
      S3_SECRET_KEY: "${MINIO_ROOT_PASSWORD}"
      S3_BUCKET_NAME: "${S3_BUCKET_NAME}"
      
      PORT: "5005"
      SECRET_KEY: "${SECRET_KEY}"
      GOOGLE_CLIENT_ID: "${GOOGLE_CLIENT_ID}"
      GOOGLE_CLIENT_SECRET: "${GOOGLE_CLIENT_SECRET}"
      GOOGLE_REDIRECT_URI: "${GOOGLE_REDIRECT_URI}"
      GEMINI_API_KEY: "${GEMINI_API_KEY}"
    depends_on:
      - minio 
    networks:
      - totem-network

  # ---------------------------------
  # SERVICIO 2: MINIO
  # ---------------------------------
  minio:
    image: minio/minio:RELEASE.2025-04-22T22-12-26Z
    restart: always
    volumes:
      - minio-data:/data
    environment:
      MINIO_ROOT_USER: "${MINIO_ROOT_USER}"
      MINIO_ROOT_PASSWORD: "${MINIO_ROOT_PASSWORD}"
      MINIO_BROWSER_REDIRECT_URL: "${MINIO_BROWSER_REDIRECT_URL}"
    command: server /data --console-address ":9001"
    ports:
      - "9000:9000" # Puerto S3 (para acceso PÚBLICO si lo necesitas)
      - "9001:9001" # Puerto Consola Web
    networks:
      - totem-network

# Define el volumen para que Minio guarde datos
volumes:
  minio-data:

# Define la red que ambos usarán
networks:
  totem-network:
    driver: bridge